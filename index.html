<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="manifest" href="./manifest.json">
<link rel="icon" type="image/png" href="./favicon.png">
<title>ãŠãã™ã‚Šç®¡ç†</title>

<style>
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: #f5f5f5;
  }

  header {
    padding: 30px;
    background: #ffffff;
    text-align: center;
    font-size: 60px;
    font-weight: bold;
    border-bottom: 1px solid #ddd;
  }

  nav {
    display: flex;
    background: #ffffff;
    border-bottom: 1px solid #ddd;
  }

  nav button {
    flex: 1;
    padding: 24px;
    font-size: 42px;
    border: none;
    background: none;
    font-weight: bold;
  }

  nav button.active {
    background: #d0d0d0;
    font-weight: bold;
  }

  main {
    padding: 30px;
  }
  
  #date {
    font-size: 50px;
    margin: 16px;
  }
  
  h2 {
    text-align: center;
    font-size: 24px;
  }

  .medicine {
    display: flex;
    align-items: center;
    padding: 32px;
    margin-bottom: 20px;
    background: #ffffff;
    border-radius: 8px;
    font-size: 42px;
    cursor: pointer;
  }

  .medicine.taken {
    opacity: 0.5;
  }

  .check {
    width: 40px;
    height: 40px;
    margin-right: 12px;
    border-radius: 50%;
    border: 2px solid #666;
    background: #fff;
  }

  .medicine.taken .check {
    background: #4caf50;
    border-color: #4caf50;
  }
</style>
</head>

<body>

<header>
  ğŸ’Š ãŠãã™ã‚Šç®¡ç†
  <div id="date"></div>
</header>

<nav>
  <button id="btn-morning" onclick="showPage('morning')">æœ</button>
  <button id="btn-night" onclick="showPage('night')">å¤œ</button>
</nav>

<main id="list"></main>

<h2>
  æœè–¬çŠ¶æ³ã¯æ¯æ—¥ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã®ã§å®‰å¿ƒã—ã¦ãã ã•ã„ã€‚
</h2>

<script>

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./sw.js")
    .then(reg => {
      console.log("SW registered:", reg.scope);
    })
    .catch(err => {
      console.error("SW failed:", err);
    });
}

if ("Notification" in window) {
  Notification.requestPermission().then(result => {
    console.log("é€šçŸ¥è¨±å¯:", result);
  });
}

/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */
const medicines = [
  { name: "è¡€åœ§ã®è–¬", timing: "morning", order: 1, taken: false },
  { name: "ãƒ“ã‚¿ãƒŸãƒ³", timing: "morning", order: 2, taken: false },
  { name: "æŠ—ç”Ÿç‰©è³ª", timing: "night", order: 1, taken: false },
  { name: "ç´°èƒ", timing: "night", order: 2, taken: false }
];

/* ===== æ—¥ä»˜å‡¦ç† ===== */
function today() {
  const d = new Date();
  return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
}

document.getElementById("date").textContent = today();

/* ===== æ¯æ—¥ãƒªã‚»ãƒƒãƒˆ ===== */
const lastDate = localStorage.getItem("lastDate");
if (lastDate !== today()) {
  medicines.forEach(m => m.taken = false);
  localStorage.setItem("lastDate", today());
}

const saved = localStorage.getItem("medicines");
if (saved) {
  const data = JSON.parse(saved);
  medicines.forEach(m => {
    const s = data.find(x => x.name === m.name);
    if (s) m.taken = s.taken;
  });
}

/* ===== è¡¨ç¤º ===== */
let current = "morning";

function showPage(timing) {
  current = timing;

  document.getElementById("btn-morning").classList.toggle("active", timing === "morning");
  document.getElementById("btn-night").classList.toggle("active", timing === "night");

  const list = document.getElementById("list");
  list.innerHTML = "";

  medicines
    .filter(m => m.timing === timing)
    .sort((a, b) => a.order - b.order)
    .forEach(m => {
      const div = document.createElement("div");
      div.className = "medicine" + (m.taken ? " taken" : "");

      div.innerHTML = `
        <div class="check"></div>
        <div>${m.name}</div>
      `;

      div.onclick = () => {
        m.taken = !m.taken;
        save();
        showPage(current);
      };

      list.appendChild(div);
    });
}

/* ===== ä¿å­˜ ===== */
function save() {
  localStorage.setItem("medicines", JSON.stringify(medicines));
}

/* ===== åˆæœŸè¡¨ç¤ºï¼ˆæ™‚é–“ã§è‡ªå‹•ï¼‰ ===== */
const hour = new Date().getHours();
showPage(hour < 15 ? "morning" : "night");
</script>

</body>
</html>